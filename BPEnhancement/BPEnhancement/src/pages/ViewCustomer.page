<apex:page standardStylesheets="false" controller="ViewCustomerCtrl"
            showChat="false" showHeader="false" sidebar="false">
    
<html ng-app="viewCus">
    <head>
        <title>View Customer</title>  
    </head>
    
    <!-- Styles -->
    <c:PageStyle />
    
    <!-- Scripts -->
    
    <c:Css_and_Js ></c:Css_and_Js>
    <apex:includeScript value="{!URLFOR($Resource.AngularResources, 'js/googlemapapiv3.js') }" />
    <apex:includeScript value="{!$Resource.AngularMap}"/>
    <apex:includeScript value="{!$Resource.niceScroll}"/>
    
    <apex:stylesheet value="{!URLFOR($Resource.simpleCalender, 'assets/css/style.css')}"/>
    <apex:includeScript value="{!URLFOR($Resource.simpleCalender, 'assets/js/simplecalendar.js') }" />
    
    <!-- Various components -->
    <c:Price_mini_page_layout ></c:Price_mini_page_layout>
    <c:Customer_mini_page_layout />
    <c:CustomerPageStyle />
    
    <c:AddEditCustomer />
    <c:AddNewCOU />
    <c:AddEditCustomerContact />
    
    <script>
            var orderName = '';
            var top_for_scroll = 0;
            $(document).ready(function () {
                $('#collapsible-header .navbar-header').hide();
                $('#collapsible-header #bs-example-navbar-collapse-1>div').hide();
                $('#collapsible-header #bs-example-navbar-collapse-1>ul').hide();
                $('#headerHidebtn').hide();
                $('#headershowbtn').show();
                
                
                
                setTimeout(function () {
                    $('[data-toggle="tooltip"]').tooltip({placement : 'bottom'});
                    $("body").niceScroll({
                        mousescrollstep : 50
                    });
            
                    top_for_scroll = $('#collapsible-header').height() + $('#fixed-seacrh-row').height() + $('#sticky-heading').height();
            
                    $('#headerHidebtn').click(function () {
                        $('#collapsible-header .navbar-header').hide();
                        $('#collapsible-header #bs-example-navbar-collapse-1>div').hide();
                        $('#collapsible-header #bs-example-navbar-collapse-1>ul').hide();
            
                        $('#headerHidebtn').hide();
                        $('#headershowbtn').show();
                        $('#workflow-sidepanel').css('top', $('#collapsible-header').height());
                        $('#fixed-seacrh-row').css('top', $('#collapsible-header').height());
                        $('#sticky-heading').css('top', $('#collapsible-header').height() + $('#fixed-seacrh-row').height());
                        top_for_scroll = $('#collapsible-header').height() + $('#fixed-seacrh-row').height() + $('#sticky-heading').height();
                    })
                    $('#headershowbtn').click(function () {
                        $('#collapsible-header .navbar-header').show();
                        $('#collapsible-header #bs-example-navbar-collapse-1>div').show();
                        $('#collapsible-header #bs-example-navbar-collapse-1>ul').show();
            
                        $('#headershowbtn').hide();
                        $('#headerHidebtn').show();
                        $('#workflow-sidepanel').css('top', $('#collapsible-header').height());
                        $('#fixed-seacrh-row').css('top', $('#collapsible-header').height());
                        $('#sticky-heading').css('top', $('#collapsible-header').height() + $('#fixed-seacrh-row').height());
                        top_for_scroll = $('#collapsible-header').height() + $('#fixed-seacrh-row').height() + $('#sticky-heading').height();
                    })
            
                    $(document).on("scroll", onScroll);
            
                    $('.sections-link a[href*=#]:not([href=#])').click(function (e) {
                        //e.preventDefault();
                        $(document).off("scroll");
                        var target = $(this).attr("href");
                        //$($(this).attr("rel")).show();
                        $('html, body').stop().animate({
                            scrollTop : $(target).offset().top - top_for_scroll - 50
                        }, 1000, function () {
                            //window.location.hash = target;
                            $(document).on("scroll", onScroll);
                            onScroll();
                            return false;
                        });
                    })
            
                }, 1000);
                onScroll();
            });
            
            
            
            function onScroll(event) {
                var heading = '';
                var scrollPos = $(document).scrollTop();
                try {
                    if (scrollPos < $('#Info_Section').position().top + $('#Info_Section').height() - 75) {
                        heading = '<span class="heading_icon" ng-click="ViewCustomer.hidePanel($event, \'Info_block\')"><i class="fa fa-chevron-right"></i></span> A Info ';
                    } else if (scrollPos < $('#Statistics_Section').position().top + $('#Statistics_Section').height() - 75) {
                        heading = '<span class="heading_icon"><i class="fa fa-chevron-right"></i></span> B Statistics ';
                    } else if (scrollPos < $('#Related').position().top + $('#Related').height() - 75) {
                        heading = '<span class="heading_icon"><i class="fa fa-chevron-right"></i></span> C Related';
                    } 
                } catch(err) {
                
                }
                $('#sticky-heading').addClass('backgroundOrange');
                $('#sticky-heading').removeClass('divDisplayNone');
                $('#sticky-heading h1').html(heading);
            }
            
            // Module app for angular controller of ViewCustomer page
            var viewCus = angular.module('viewCus', ['BPGlobalHeader', 'addEditCustomerModule', 'searchToAddModule', 'addNewCOUModule', 'addNewContact', 'ngAnimate', 'ui-notification', 'ngMap']);
            
            // Angular controller for ViewCustomer page
            viewCus.controller('ViewCustomer', function ($scope, CustomerInfoService, RelatedCustomersService, CustomerOwnedUnitsService, CustomerContactsService, Notification) {
                // ViewCustomer page variable
                $scope.ViewCustomer = {};
                $scope.CustomerModal = {};
                $scope.COUModal = {};
                $scope.SearchToadd = {};
                $scope.ViewCustomer.ShowMore = true;
                $scope.ViewCustomer.customerId = "{!JSENCODE(URLENCODE($CurrentPage.parameters.id))}";
                  $scope.ViewCustomer.showAllData  = 1; 
            
                // START: Subhrant section
            
                //Map default Values declration
                $scope.ViewCustomer.activeAddress = "BillingAddress"
                    $scope.ViewCustomer.addressOnMap = "";
            
                //Change Address type on Map
                $scope.ViewCustomer.changeActiveAddress = function (address) {
                    $scope.ViewCustomer.activeAddress = address;
                    if (address == "BillingAddress") {
                        $scope.ViewCustomer.addressOnMap = $scope.ViewCustomer.CustomerInfo.CustomerInfo.BillingStreet2 + ' ' + $scope.ViewCustomer.CustomerInfo.CustomerInfo.BillingStreet1 + ' ' + $scope.ViewCustomer.CustomerInfo.CustomerInfo.BillingCity + ' ' + $scope.ViewCustomer.CustomerInfo.CustomerInfo.BillingState + ' ' + $scope.ViewCustomer.CustomerInfo.CustomerInfo.BillingCountry + ' ' + $scope.ViewCustomer.CustomerInfo.CustomerInfo.BillingPostalCode
                    } else {
                        $scope.ViewCustomer.addressOnMap = $scope.ViewCustomer.CustomerInfo.CustomerInfo.ShippingStreet2 + ' ' + $scope.ViewCustomer.CustomerInfo.CustomerInfo.ShippingStreet1 + ' ' + $scope.ViewCustomer.CustomerInfo.CustomerInfo.ShippingCity + ' ' + $scope.ViewCustomer.CustomerInfo.CustomerInfo.ShippingState + ' ' + $scope.ViewCustomer.CustomerInfo.CustomerInfo.ShippingCountry + ' ' + $scope.ViewCustomer.CustomerInfo.CustomerInfo.ShippingPostalCode
                    }
                }
                
                $scope.ViewCustomer.helpText = { Info : 'Basic information of Customer',
                                                Statistics : 'All statistics for the Customer',
                                                Vital_Statistics : 'Vital statistics for the Customer',
                                                Telemetry : 'Metrics and Measurement',
                                                Related : 'Records related to the Customer',
                                                COU : 'Customer Owned Units',
                                                Customers : 'List of other customers related to the Customer',
                                                Contacts : 'List of contacts related to the Customer'
                            };
                            
               $scope.ViewCustomer.infoLabel = { OtherEmail : 'OTHER EMAIL',
              		 							OtherPhone : 'OTHER PHONE',
              		 							MobileNumberSMS : 'OTHER NUMBER SMS',
                                                HomeEmail : 'HOME EMAIL',
                                                HomeNumber : 'HOME NUMNER',
                                                HomeNumberSMS : 'HOME NUMBER SMS',
                                                WorkEmail : 'WORK EMAIL',
                                                WorkNumber : 'WORK NUMBER',
                                                WorkNumberSMS : 'WORK NUMBER SMS'
                            };
                
                $scope.ViewCustomer.hidePanel = function(event, id){
                    var targetelement = angular.element(event.target).closest('h1').find('.fa:first');
                    if(targetelement.hasClass('fa-chevron-right')){
                        targetelement.removeClass('fa-chevron-right');
                        targetelement.addClass('fa-chevron-down');
                    } else {
                        targetelement.removeClass('fa-chevron-down');
                        targetelement.addClass('fa-chevron-right');
                    }
                    $('#'+id).toggle();
                }
                
                // set Preffered Valu in info section
                $scope.ViewCustomer.setPrefferedEmail = function () {
                    if ($scope.ViewCustomer.CustomerInfo.CustomerInfo.PreferredEmail != null && $scope.ViewCustomer.CustomerInfo.CustomerInfo.PreferredEmail != "") {
                        return $scope.ViewCustomer.CustomerInfo.CustomerInfo[$scope.ViewCustomer.CustomerInfo.CustomerInfo.PreferredEmail];
                    } else if ($scope.ViewCustomer.CustomerInfo.CustomerInfo.Type == "Individual" && ($scope.ViewCustomer.CustomerInfo.CustomerInfo.PreferredEmail == "" || $scope.ViewCustomer.CustomerInfo.CustomerInfo.PreferredEmail == null)) {
                        return ($scope.ViewCustomer.CustomerInfo.CustomerInfo.HomeEmail != null && $scope.ViewCustomer.CustomerInfo.CustomerInfo.HomeEmail !== "") ? $scope.ViewCustomer.CustomerInfo.CustomerInfo.HomeEmail : ($scope.ViewCustomer.CustomerInfo.CustomerInfo.OtherEmail != null) ? $scope.ViewCustomer.CustomerInfo.CustomerInfo.OtherEmail : ""
                    } else if ($scope.ViewCustomer.CustomerInfo.CustomerInfo.Type == "Business" && ($scope.ViewCustomer.CustomerInfo.CustomerInfo.PreferredEmail == "" || $scope.ViewCustomer.CustomerInfo.CustomerInfo.PreferredEmail != null)) {
                        return ($scope.ViewCustomer.CustomerInfo.CustomerInfo.WorkEmail != null && $scope.ViewCustomer.CustomerInfo.CustomerInfo.WorkEmail !== "") ? $scope.ViewCustomer.CustomerInfo.CustomerInfo.WorkEmail : ($scope.ViewCustomer.CustomerInfo.CustomerInfo.OtherEmail != null) ? $scope.ViewCustomer.CustomerInfo.CustomerInfo.OtherEmail : ""
                    }
                }
            
                $scope.ViewCustomer.setPrefferedPhone = function () {
                    if ($scope.ViewCustomer.CustomerInfo.CustomerInfo.PreferredPhone != null && $scope.ViewCustomer.CustomerInfo.CustomerInfo.PreferredPhone != "") {
                        $scope.ViewCustomer.CustomerInfo.CustomerInfo.PreferredPhoneLabel = $scope.ViewCustomer.CustomerInfo.CustomerInfo.PreferredPhone;
                        return $scope.ViewCustomer.CustomerInfo.CustomerInfo[$scope.ViewCustomer.CustomerInfo.CustomerInfo.PreferredPhone];
                    } else if ($scope.ViewCustomer.CustomerInfo.CustomerInfo.Type == "Individual" && ($scope.ViewCustomer.CustomerInfo.CustomerInfo.PreferredPhone == null || $scope.ViewCustomer.CustomerInfo.CustomerInfo.PreferredPhone == "")) {
                        $scope.ViewCustomer.CustomerInfo.CustomerInfo.PreferredPhoneLabel = ($scope.ViewCustomer.CustomerInfo.CustomerInfo.HomeNumber != null && $scope.ViewCustomer.CustomerInfo.CustomerInfo.HomeNumber != "") ? 'HomeNumber' : ($scope.ViewCustomer.CustomerInfo.CustomerInfo.OtherPhone != null) ? 'OtherPhone' : "HomeNumber";
                        return ($scope.ViewCustomer.CustomerInfo.CustomerInfo.HomeNumber != null && $scope.ViewCustomer.CustomerInfo.CustomerInfo.HomeNumber != "") ? $scope.ViewCustomer.CustomerInfo.CustomerInfo.HomeNumber : ($scope.ViewCustomer.CustomerInfo.CustomerInfo.OtherPhone != null) ? $scope.ViewCustomer.CustomerInfo.CustomerInfo.OtherPhone : ""
                    } else if ($scope.ViewCustomer.CustomerInfo.CustomerInfo.Type == "Business" && ($scope.ViewCustomer.CustomerInfo.CustomerInfo.PreferredPhone == null || $scope.ViewCustomer.CustomerInfo.CustomerInfo.PreferredPhone == "")) {
                        $scope.ViewCustomer.CustomerInfo.CustomerInfo.PreferredPhoneLabel = ($scope.ViewCustomer.CustomerInfo.CustomerInfo.WorkNumber != null && $scope.ViewCustomer.CustomerInfo.CustomerInfo.WorkNumber != "") ? 'WorkNumber' : ($scope.ViewCustomer.CustomerInfo.CustomerInfo.OtherPhone != null) ? 'OtherPhone' : "WorkNumber";
                        return ($scope.ViewCustomer.CustomerInfo.CustomerInfo.WorkNumber != null && $scope.ViewCustomer.CustomerInfo.CustomerInfo.WorkNumber != "") ? $scope.ViewCustomer.CustomerInfo.CustomerInfo.WorkNumber : ($scope.ViewCustomer.CustomerInfo.CustomerInfo.OtherPhone != null) ? $scope.ViewCustomer.CustomerInfo.CustomerInfo.OtherPhone : ""
                    }
                }
            
                $scope.ViewCustomer.setPrefferedSMS = function () {
                    if ($scope.ViewCustomer.CustomerInfo.CustomerInfo.PreferredSMS != null && $scope.ViewCustomer.CustomerInfo.CustomerInfo.PreferredSMS != "") {
                        $scope.ViewCustomer.CustomerInfo.CustomerInfo.PreferredSMSLabel = $scope.ViewCustomer.CustomerInfo.CustomerInfo.PreferredSMS;
                        return $scope.ViewCustomer.CustomerInfo.CustomerInfo[$scope.ViewCustomer.CustomerInfo.CustomerInfo.PreferredSMS];
                    } else if ($scope.ViewCustomer.CustomerInfo.CustomerInfo.Type == "Individual" && ($scope.ViewCustomer.CustomerInfo.CustomerInfo.PreferredSMS == null || $scope.ViewCustomer.CustomerInfo.CustomerInfo.PreferredSMS == "")) {
                        $scope.ViewCustomer.CustomerInfo.CustomerInfo.PreferredSMSLabel = ($scope.ViewCustomer.CustomerInfo.CustomerInfo.HomeNumberSMS != false) ? 'HomeNumberSMS' : ($scope.ViewCustomer.CustomerInfo.CustomerInfo.MobileNumberSMS != false) ? "MobileNumberSMS" : "HomeNumberSMS";
                        return ($scope.ViewCustomer.CustomerInfo.CustomerInfo.HomeNumberSMS != false) ? $scope.ViewCustomer.CustomerInfo.CustomerInfo.HomeNumber : ($scope.ViewCustomer.CustomerInfo.CustomerInfo.MobileNumberSMS != false) ? $scope.ViewCustomer.CustomerInfo.CustomerInfo.OtherPhone : ""
                    } else if ($scope.ViewCustomer.CustomerInfo.CustomerInfo.Type == "Business" && ($scope.ViewCustomer.CustomerInfo.CustomerInfo.PreferredSMS == null || $scope.ViewCustomer.CustomerInfo.CustomerInfo.PreferredSMS == "")) {
                        $scope.ViewCustomer.CustomerInfo.CustomerInfo.PreferredSMSLabel = ($scope.ViewCustomer.CustomerInfo.CustomerInfo.WorkNumberSMS != false) ? 'WorkNumberSMS' : ($scope.ViewCustomer.CustomerInfo.CustomerInfo.MobileNumberSMS != false) ? "MobileNumberSMS" : "WorkNumberSMS";
                        return ($scope.ViewCustomer.CustomerInfo.CustomerInfo.WorkNumberSMS != false) ? $scope.ViewCustomer.CustomerInfo.CustomerInfo.WorkNumber : ($scope.ViewCustomer.CustomerInfo.CustomerInfo.MobileNumberSMS != false) ? $scope.ViewCustomer.CustomerInfo.CustomerInfo.OtherPhone : ""
                    }
                }
            
                //Hide Show Detail Section of Info section
                $scope.ViewCustomer.showMoreDetails = function (status) {
                    $scope.ViewCustomer.ShowMore = status;
                }
            
                //Save response
                $scope.ViewCustomer.saveCustomer = function (result) {
                
                    if( result.Id.length == 18) {
                         result.Id =  result.Id.substring(0, 15);
                    }
                    if($scope.ViewCustomer.customerId.length == 18) {
                        $scope.ViewCustomer.customerId = $scope.ViewCustomer.customerId.substring(0, 15);
                    }
                    
                    
                    if ($scope.ViewCustomer.customerId == result.Id) {
                        var customerId = $scope.ViewCustomer.customerId;
            
                        CustomerInfoService.getCustomerInfo(customerId).then(function (customerInfo) {
                            $scope.ViewCustomer.CustomerInfo = customerInfo;
                            $scope.ViewCustomer.changeActiveAddress('BillingAddress');
                        });
                    } else {
                        $scope.ViewCustomer.addUpdateCustomerRecord(result.Id, "Family");
                    }
                }
            
                $scope.ViewCustomer.AddNewCustomer = function () {
                    $scope.$broadcast('AddCustomerEvent');
                }
            
                $scope.ViewCustomer.editCustomerDetails = function () {
                    var CustomerId = $scope.ViewCustomer.customerId;
                    $scope.$broadcast('EditCustomerEvent', CustomerId);
                }
            
                $scope.ViewCustomer.editRelatedCustomerPopUp = function (relatedCustomer) {
                    $scope.$broadcast('EditCustomerRelatedEvent', relatedCustomer);
                }
            // END: Subhrant Section
            
            // Set focus on search text box
            // used when to add related records via page level search box
            $scope.setFocusToSearchBox = function () {
                angular.element('#SearchToaddCutomer').focus();
            }
            
            // Load Customer Infomration
            $scope.ViewCustomer.loadCustomerInfo = function(){
                var customerId = $scope.ViewCustomer.customerId;
                CustomerInfoService.getCustomerInfo(customerId).then(function(customerInfo) {
                    if(customerInfo != {} && customerInfo.CustomerInfo != null)
                    {
                        $scope.ViewCustomer.CustomerInfo = customerInfo;
                        $scope.ViewCustomer.ShowContent = true;
                        
                        // Set all the data models
                        $scope.setAllData(customerInfo);
                         $scope.ViewCustomer.changeActiveAddress('BillingAddress');
                        // Load Customer master data
                        $scope.$broadcast('LoadMasterData');
                    }
                    else
                    {
                        $scope.ViewCustomer.showAllData  = 0;
                    }
                }, function(errorSearchResult) {
                    $scope.ViewCustomer.CustomerInfo = errorSearchResult;
                    $scope.ViewCustomer.ShowContent = false;
                    $scope.ViewCustomer.showAllData  = 0;
                });
            }
            
            // Method to set all data models in local models
            $scope.setAllData = function (customerInfo) {
                $scope.ViewCustomer.User = {
                    Name : '{!JSENCODE($User.FirstName)}' + ' ' + '{!JSENCODE($User.LastName)}',
                    Value : ''
                }
                
                // Set Customer Owned Units data
                $scope.ViewCustomer.CMOwnedUnits = [];
                $scope.ViewCustomer.UpdateOwnedUnitsLists(customerInfo.CustomerOwnedUnitList);
                
                // Set related Customers data
                $scope.ViewCustomer.CMCustomers = [];
                $scope.ViewCustomer.UpdateRelatedCustomersLists(customerInfo.RelatedCustomerList);
                
                // Set Cusotomer contacts data
                $scope.ViewCustomer.CMContacts = [];
                $scope.ViewCustomer.UpdateCustomerContactsLists(customerInfo.ContactList);
            }
            
            // Method to update the Customer owned units related list records in JSON model
            $scope.ViewCustomer.UpdateOwnedUnitsLists = function (CustomerOwnedUnitList) {
                $scope.ViewCustomer.CMOwnedUnits = CustomerOwnedUnitList;
                $scope.ViewCustomer.CMOwnedUnits_editRow = [];
        
                for (i = 0; i < $scope.ViewCustomer.CMOwnedUnits.length; i++) {
                    $scope.ViewCustomer.CMOwnedUnits_editRow.push({
                        isEdit : false,
                        radioValue : 0,
                        optionSelected : 0
                    });
                }
            }
            
            // Method to update the related customers list records in JSON model
            $scope.ViewCustomer.UpdateRelatedCustomersLists = function (RelatedCustomersList) {
                $scope.ViewCustomer.CMCustomers = RelatedCustomersList;
                $scope.ViewCustomer.CMCustomers_editRow = [];
        
                for (i = 0; i < $scope.ViewCustomer.CMCustomers.length; i++) {
                    $scope.ViewCustomer.CMCustomers_editRow.push({
                        isEdit : false,
                        radioValue : 0,
                        optionSelected : 0
                    });
                }
            }
            
            // Method to update the customer contacts list records in JSON model
            $scope.ViewCustomer.UpdateCustomerContactsLists = function (ContactList) {
                $scope.ViewCustomer.CMContacts = ContactList;
                $scope.ViewCustomer.CMContacts_editRow = [];
        
                for (i = 0; i < $scope.ViewCustomer.CMContacts.length; i++) {
                    $scope.ViewCustomer.CMContacts_editRow.push({
                        isEdit : false,
                        radioValue : 0,
                        optionSelected : 0
                    });
                }
            }
            
            // Identify durty owned units and save to server the units
            $scope.ViewCustomer.closeEditCustomerOwnedUnitRows = function (event) {
                $scope.ViewCustomer.UpdateOwnedUnitsLists($scope.ViewCustomer.CMOwnedUnits);
            }
            
            // Identify durty customer records and save to server
            $scope.ViewCustomer.closeEditCustomerRows = function (event) {
                $scope.ViewCustomer.UpdateRelatedCustomersLists($scope.ViewCustomer.CMCustomers);
            }
            
            // Identify durty contacts and save to server
            $scope.ViewCustomer.closeEditContactRows = function (event) {
                $scope.ViewCustomer.UpdateCustomerContactsLists($scope.ViewCustomer.CMContacts);
            }
            
            // Edit owned unit and save previous unit to server
            $scope.ViewCustomer.editOwnedUnit = function (event, index) {
                var isEditModeEnabled = false;
                var durtyCustomerOwnedUnits = [];
                for (i = 0; i < $scope.ViewCustomer.CMOwnedUnits_editRow.length; i++) {
                    if ($scope.ViewCustomer.CMOwnedUnits_editRow[i].isEdit == true) {
                        isEditModeEnabled = true;
                        durtyCustomerOwnedUnits.push(JSON.stringify($scope.ViewCustomer.CMOwnedUnits[i]));
                    }
                    $scope.ViewCustomer.CMOwnedUnits_editRow[i].isEdit = false;
                }
                
                if (!isEditModeEnabled) {
                    $scope.ViewCustomer.CMOwnedUnits_editRow[index].isEdit = true;
                    setTimeout(function () {
                        angular.element(event.target).closest('tr').next().find('input').filter(':first').focus();
                    }, 10);
                } else {
                    // Save customer owned units to server
                    //$scope.ViewCustomer.SaveCustomerOwnedUnitsToserver(durtyCustomerOwnedUnits);
                }
            }
            
            // Edit customer and save previous customer to server
            $scope.ViewCustomer.editRelatedCustomer = function (event, index) {
                var isEditModeEnabled = false;
                var durtyCustomers = [];
                for (i = 0; i < $scope.ViewCustomer.CMCustomers_editRow.length; i++) {
                    if ($scope.ViewCustomer.CMCustomers_editRow[i].isEdit == true) {
                        isEditModeEnabled = true;
                        durtyCustomers.push(JSON.stringify($scope.ViewCustomer.CMCustomers[i]));
                    }
                    $scope.ViewCustomer.CMCustomers_editRow[i].isEdit = false;
                }
                
                if (!isEditModeEnabled) {
                    $scope.ViewCustomer.CMCustomers_editRow[index].isEdit = true;
                    setTimeout(function () {
                        angular.element(event.target).closest('tr').next().find('input').filter(':first').focus();
                    }, 10);
                } else {
                    // Save customer owned units to server
                    //$scope.ViewCustomer.addUpdateCustomerRecord = function (relatedCustomerId, relation);
                }
            }
            
            // Edit related Contact and save previous contact to server
            $scope.ViewCustomer.editRelatedContact = function (event, index) {
                var isEditModeEnabled = false;
                var durtyContacts = [];
                for (i = 0; i < $scope.ViewCustomer.CMContacts_editRow.length; i++) {
                    if ($scope.ViewCustomer.CMContacts_editRow[i].isEdit == true) {
                        isEditModeEnabled = true;
                        durtyContacts.push(JSON.stringify($scope.ViewCustomer.CMContacts[i]));
                    }
                    $scope.ViewCustomer.CMContacts_editRow[i].isEdit = false;
                }
                
                if (!isEditModeEnabled) {
                    $scope.ViewCustomer.CMContacts_editRow[index].isEdit = true;
                    setTimeout(function () {
                        angular.element(event.target).closest('tr').next().find('input').filter(':first').focus();
                    }, 10);
                } else {
                    // Save related contacts to server
                    //$scope.ViewCustomer.updateContactsToServer(durtyContacts);
                }
            }
            
            // Save method for customer owned units
            $scope.ViewCustomer.SaveCustomerOwnedUnitsToserver = function (selectedCOURecords) {
                var customerId = $scope.ViewCustomer.customerId;
                
                // Update customer to database and refresh list
                // Method to add/update customers JSON array and refresh related customers list
                CustomerOwnedUnitsService.addCustomerOwnedUnit(customerId, selectedCOURecords).then(function(relatedCOUList) {
                    // Set all the data models
                    $scope.ViewCustomer.UpdateOwnedUnitsLists(relatedCOUList);
                    
                    if(angular.element('#AddNewCOU') != null){
                        angular.element('#AddNewCOU').modal('hide');
                    }
                }, function(errorSearchResult) {
                    $scope.ViewCustomer.CustomerInfo = errorSearchResult;
                });
            }
            
            // Method to perform Delete operation for Customer Owned Unit in database
            $scope.ViewCustomer.removeCustomerOwnedUnitRecord = function (customerOwnedUnitId) {
                CustomerOwnedUnitsService.removeCustomerOwnedUnit($scope.ViewCustomer.customerId, customerOwnedUnitId).then(function (relatedCOUList) {
                    $scope.ViewCustomer.UpdateOwnedUnitsLists(relatedCOUList);
                }, function (errorSearchResult) {
                    $scope.ViewCustomer.CustomerInfo = errorSearchResult;
                });
            }
            
            // Method used to get and update all related customers list
            $scope.ViewCustomer.getAndUpdateRelatedCustomers = function (){
                var customerId = $scope.ViewCustomer.customerId;
                RelatedCustomersService.getRelatedCustomers(customerId).then(function(relatedCustomers) {
                    // Set all the data models
                    $scope.ViewCustomer.UpdateRelatedCustomersLists(relatedCustomers);
                }, function(errorSearchResult) {
                    $scope.ViewCustomer.CustomerInfo = errorSearchResult;
                });
            }
            
            // Callback method when a customer is selected from search box to add a new customer in related customers section
            $scope.ViewCustomer.selectCallBack = function(selectedRecord)
            {
                // If selected value is a Customer, then add the record in related cutomers list
                if(selectedRecord.originalObject.Info == 'Customer'){
                    var parentCustomerId = $scope.ViewCustomer.customerId;
                    var selectedRecordId = selectedRecord.originalObject.Value;
                    
                    if(selectedRecordId.length == 18) {
                        selectedRecordId = selectedRecordId.substring(0, 15);
                    }
                    if(parentCustomerId.length == 18) {
                        parentCustomerId = parentCustomerId.substring(0, 15);
                    }
                    if(parentCustomerId == selectedRecordId) {
                        Notification.error('Can\'t add parent customer as child in related list');
                        return;
                    }
                    $scope.ViewCustomer.addUpdateCustomerRecord(selectedRecord.originalObject.Value, 'Family');
                    
                }
                else if(selectedRecord.originalObject.Info == 'Contact'){
                    // ToDo
                } else if(selectedRecord.originalObject.Info == 'CustomerOwnedUnit'){
                    // ToDo
                }
            }
            
            // Add/Update action method for Related customer update
            // Create a JSON array for updated customer and update
            $scope.ViewCustomer.addUpdateCustomerRecord = function (relatedCustomerId, relation) {
                var parentCustomerId = $scope.ViewCustomer.customerId;
                var selectedCustomerRecords = [{
                    Id : relatedCustomerId,
                    Relation : relation,
                    ParentCustomer : parentCustomerId
                }];
                
                // Update customer to database and refresh list
                // Method to add/update customers JSON array and refresh related customers list
                RelatedCustomersService.addRelatedCustomer(selectedCustomerRecords).then(function(relatedCustomers) {
                    // Set all the data models
                    $scope.ViewCustomer.UpdateRelatedCustomersLists(relatedCustomers);
                }, function(errorSearchResult) {
                    $scope.ViewCustomer.CustomerInfo = errorSearchResult;
                });
            }
            
            // Add/Update action method for Related contact update
            // Create a JSON array for updated contact and update
            $scope.ViewCustomer.addUpdateContactRecord = function (relatedContactId, relation) {
                var parentCustomerId = $scope.ViewCustomer.customerId;
                
                var selectedContactRecords = [{
                    Id : relatedContactId,
                    Relation : relation,
                    ParentCustomer : parentCustomerId
                }];
                
                // Method to add/update customers JSON array and refresh related customers list
                CustomerContactsService.updateRelation(selectedContactRecords).then(function(relatedContacts) {
                    // Set all the data models
                    $scope.ViewCustomer.UpdateCustomerContactsLists(relatedContacts);
                }, function(errorSearchResult) {
                    $scope.ViewCustomer.CustomerInfo = errorSearchResult;
                });
            }
            
            // Method to save a Related contacts list to server which calls a service method
            $scope.ViewCustomer.updateContactsToServer = function(selectedContactRecords) {
                // Update customer to database and refresh list
                // Method to add/update customers JSON array and refresh related customers list
                CustomerContactsService.addCustomerContact(selectedContactRecords).then(function(relatedContacts) {
                    // Set all the data models
                    $scope.ViewCustomer.UpdateCustomerContactsLists(relatedContacts);
                }, function(errorSearchResult) {
                    $scope.ViewCustomer.CustomerInfo = errorSearchResult;
                });
            }
            
            // Method to perform Delete operation in database
            $scope.ViewCustomer.removeCustomerContactRecord = function (customerContactId) {
                CustomerContactsService.removeCustomerContact($scope.ViewCustomer.customerId, customerContactId).then(function (relatedCustomerContactList) {
                    $scope.ViewCustomer.UpdateCustomerContactsLists(relatedCustomerContactList);
                }, function (errorSearchResult) {
                    $scope.ViewCustomer.CustomerInfo = errorSearchResult;
                });
            }
            
            // Add/Update action method for Related Customer Owned Unit update
            // Create a JSON array for updated COU and update
            $scope.ViewCustomer.addUpdateCOURecord = function (couId) {
                var selectedCOURecords = [{
                    Id : couId
                }];
                
                $scope.ViewCustomer.SaveCustomerOwnedUnitsToserver(angular.toJson(selectedCOURecords));
            }
            
            // Related Customer Owned Unit: selected action method after row edit
            $scope.ViewCustomer.CM_OwnedUnits_GoAction = function (indexVal) {
                // selected radio value == 1 Means Edit the record via EditCOU popup window
                if($scope.ViewCustomer.CMOwnedUnits_editRow[indexVal].radioValue == 1){
                    $scope.ViewCustomer.openEditCustomerOwnedUnitPopup($scope.ViewCustomer.CMOwnedUnits[indexVal].Id);
                } else if($scope.ViewCustomer.CMOwnedUnits_editRow[indexVal].radioValue == 2){
                    // ToDo
                } else if($scope.ViewCustomer.CMOwnedUnits_editRow[indexVal].radioValue == 3){
                    // ToDo
                } else if($scope.ViewCustomer.CMOwnedUnits_editRow[indexVal].radioValue == 4){
                    // selected radio value == 2 Means delete the record from the customer Owned Unit
                    $scope.ViewCustomer.removeCustomerOwnedUnitRecord($scope.ViewCustomer.CMOwnedUnits[indexVal].Id);
                }
            }
            
            // Related Customers: selected action method after row edit
            $scope.ViewCustomer.CM_Customers_GoAction = function (indexVal) {
                // selected radio value == 1 Means Edit the record via EditCustomer popup window
                if($scope.ViewCustomer.CMCustomers_editRow[indexVal].radioValue == 1){
                   $scope.ViewCustomer.editRelatedCustomerPopUp($scope.ViewCustomer.CMCustomers[indexVal].Id);
                } else if($scope.ViewCustomer.CMCustomers_editRow[indexVal].radioValue == 2){
                    // selected radio value == 2 Means delete the record from the customers list
                    $scope.ViewCustomer.addUpdateCustomerRecord($scope.ViewCustomer.CMCustomers[indexVal].Id, "");
                }
            }
            
            // Related Customer Contact: selected action method after row edit
            $scope.ViewCustomer.CM_Contacts_GoAction = function (indexVal) {
                // selected radio value == 1 Means Edit the record via EditContact popup window
                if($scope.ViewCustomer.CMContacts_editRow[indexVal].radioValue == 1){
                    $scope.ViewCustomer.openEditContactPopup($scope.ViewCustomer.CMContacts[indexVal].Id);
                } else if($scope.ViewCustomer.CMContacts_editRow[indexVal].radioValue == 2){
                    // selected radio value == 2 Means delete the record from the customer related list
                    $scope.ViewCustomer.removeCustomerContactRecord($scope.ViewCustomer.CMContacts[indexVal].Id);
                }
            }
            
            //START: Customer Owned Unit popup methods:
            // Method to open ADD customer owned unit popup
            $scope.ViewCustomer.openAddCustomerOwnedUnitPopup = function(event) {
                event.stopPropagation();
                // Broadcast an event for Add Customer Owned Unit popup to open and set data
                $scope.$broadcast('AddCustomerOwnedUnitEvent');
            }
            
            // Method to open EDIT customer owned unit popup
            $scope.ViewCustomer.openEditCustomerOwnedUnitPopup = function(selectedCOUId) {
                // Broadcast an event for Add Customer Owned Unit popup to open and set data
                $scope.$broadcast('EditCustomerOwnedUnitEvent', {couId : selectedCOUId});
            }
            
            // Method to perform callback actions when a Customer Owned Unit record is saved to database
            // Add COU record to customer related COU list and refresh the list
            $scope.ViewCustomer.callbackAfterCOUSave = function() {
                // Broadcast an event for Add Customer Owned Unit popup to open and set data
                $scope.$broadcast('AddCustomerOwnedUnitEvent');
            }
            //END: Customer Owned Unit popup methods:
            
            // START: Customer Contact popup methods:
            // Method to call an event for Contact popup
            $scope.ViewCustomer.openAddContactPopup = function() {
                $scope.$broadcast('AddContactEvent', {parentCustomerId : $scope.ViewCustomer.customerId});
            }
            
            // Method to open EDIT customer contact popup
            $scope.ViewCustomer.openEditContactPopup = function(selectedContactId) {
                // Broadcast an event for Add Customer Owned Unit popup to open and set data
                $scope.$broadcast('EditContactEvent', {contactId : selectedContactId, parentCustomerId : $scope.ViewCustomer.customerId});
            }
            //END: Customer Contact popup methods: 
        }); 
        
        viewCus.service("CustomerInfoService", function ($q) {
            this.getCustomerInfo= function(customerId)
            {
                    customerId = encodeString(customerId);
                    var deferred = $q.defer();
                    Visualforce.remoting.Manager.invokeAction(
                        '{!$RemoteAction.ViewCustomerCtrl.getCustomerInfo}',
                        customerId,
                        function (result, event) {
                           if (event.type == 'exception') {
                                deferred.reject(event.message);
                            } else {
                                var customerInfo = decodeString(result);
                                var find = '\'';
                                var re = new RegExp(find, 'g');
                                customerInfo = customerInfo.replace(re, '');
                                deferred.resolve(JSON.parse(customerInfo));
                            }
                        }, {
                            escape : true
                    });
                    return deferred.promise;
            }
        });
        
        // Service related to Customer Owned units list
        viewCus.service("CustomerOwnedUnitsService", function ($q) {
            // Get method for retrival of a customer owned unit with specified Id
            this.getCustomerOwnedUnitById = function(couId)
            {
                    couId = encodeString(couId);
                    var deferred = $q.defer();
                    Visualforce.remoting.Manager.invokeAction(
                        '{!$RemoteAction.ViewCustomerCtrl.getCOURecordById}',
                        couId,
                        function (result, event) {
                           if (event.type == 'exception') {
                                deferred.reject(event.message);
                            } else {
                                var customerOwnedUnit = decodeString(result);
                                var find = '\'';
                                var re = new RegExp(find, 'g');
                                customerOwnedUnit = customerOwnedUnit.replace(re, '');
                                deferred.resolve(JSON.parse(customerOwnedUnit));
                            }
                        }, {
                            escape : true
                    });
                    return deferred.promise;
            }
            
            // Get method for retrival of all related customer owned units
            this.getCustomerOwnedUnits = function(customerId)
            {
                    customerId = encodeString(customerId);
                    var deferred = $q.defer();
                    Visualforce.remoting.Manager.invokeAction(
                        '{!$RemoteAction.ViewCustomerCtrl.getCOUListByCustomerId}',
                        customerId,
                        function (result, event) {
                           if (event.type == 'exception') {
                                deferred.reject(event.message);
                            } else {
                                var customerOwnedUnits = decodeString(result);
                                var find = '\'';
                                var re = new RegExp(find, 'g');
                                customerOwnedUnits = customerOwnedUnits.replace(re, '');
                                deferred.resolve(JSON.parse(customerOwnedUnits));
                            }
                        }, {
                            escape : true
                    });
                    return deferred.promise;
            }
            
            // Add/Update method for a customer owned unit to add in related customer owned units list
            this.addCustomerOwnedUnit= function(customerId, customerOwnedUnitJSON)
            {
                    customerId = encodeString(customerId);
                    customerOwnedUnitJSON = encodeString(customerOwnedUnitJSON);
                    var deferred = $q.defer();
                    Visualforce.remoting.Manager.invokeAction(
                        '{!$RemoteAction.ViewCustomerCtrl.saveCOU}',
                        customerId, customerOwnedUnitJSON,
                        function (result, event) {
                           if (event.type == 'exception') {
                                deferred.reject(event.message);
                            } else {
                                var customerOwnedUnits = decodeString(result);
                                var find = '\'';
                                var re = new RegExp(find, 'g');
                                customerOwnedUnits = customerOwnedUnits.replace(re, '');
                                deferred.resolve(JSON.parse(customerOwnedUnits));
                            }
                        }, {
                            escape : true
                    });
                    return deferred.promise;
            }
            
            // Remove method for a customer owned unit
            this.removeCustomerOwnedUnit= function(customerId, customerOwnedUnitId)
            {
                    customerId = encodeString(customerId);
                    customerOwnedUnitId = encodeString(customerOwnedUnitId);
                    var deferred = $q.defer();
                    Visualforce.remoting.Manager.invokeAction(
                        '{!$RemoteAction.ViewCustomerCtrl.removeCOURecord}',
                        customerId, customerOwnedUnitId,
                        function (result, event) {
                           if (event.type == 'exception') {
                                deferred.reject(event.message);
                            } else {
                                var customerOwnedUnits = decodeString(result);
                                var find = '\'';
                                var re = new RegExp(find, 'g');
                                customerOwnedUnits = customerOwnedUnits.replace(re, '');
                                deferred.resolve(JSON.parse(customerOwnedUnits));
                            }
                        }, {
                            escape : true
                    });
                    return deferred.promise;
            }
        });
        
        // Service related to Customer related customers
        viewCus.service("RelatedCustomersService", function ($q) {
        
            // Get method for retrival of all related customers for customer Id
            this.getRelatedCustomers = function(customerId)
            {
                    customerId = encodeString(customerId);
                    var deferred = $q.defer();
                    Visualforce.remoting.Manager.invokeAction(
                        '{!$RemoteAction.ViewCustomerCtrl.getRelatedCustomerByCustomerId}',
                        customerId,
                        function (result, event) {
                           if (event.type == 'exception') {
                                deferred.reject(event.message);
                            } else {
                                var relatedCustomers = decodeString(result);
                                var find = '\'';
                                var re = new RegExp(find, 'g');
                                relatedCustomers = relatedCustomers.replace(re, '');
                                deferred.resolve(JSON.parse(relatedCustomers));
                            }
                        }, {
                            escape : true
                    });
                    return deferred.promise;
            }
            
            // Add/Update method for a customer to add in related customers list
            this.addRelatedCustomer= function(customerJSON)
            {
                    customerJSON = encodeString(angular.toJson(customerJSON));
                    var deferred = $q.defer();
                    Visualforce.remoting.Manager.invokeAction(
                        '{!$RemoteAction.ViewCustomerCtrl.updateRelatedCustomer}',
                        customerJSON,
                        function (result, event) {
                           if (event.type == 'exception') {
                                deferred.reject(event.message);
                            } else {
                                var relatedCustomers = decodeString(result);
                                var find = '\'';
                                var re = new RegExp(find, 'g');
                                relatedCustomers = relatedCustomers.replace(re, '');
                                deferred.resolve(JSON.parse(relatedCustomers));
                            }
                        }, {
                            escape : true
                    });
                    return deferred.promise;
            }
        });
        
        // Service related to Customer Contacts list
        viewCus.service("CustomerContactsService", function ($q) {
            // Get method for retrival of all related customer contacts
            this.getCustomerContacts = function(customerId)
            {
                    customerId = encodeString(customerId);
                    var deferred = $q.defer();
                    Visualforce.remoting.Manager.invokeAction(
                        '{!$RemoteAction.ViewCustomerCtrl.getCustomerContactByCustomerId}',
                        customerId,
                        function (result, event) {
                           if (event.type == 'exception') {
                                deferred.reject(event.message);
                            } else {
                                var customerContacts = decodeString(result);
                                var find = '\'';
                                var re = new RegExp(find, 'g');
                                customerContacts = customerContacts.replace(re, '');
                                deferred.resolve(JSON.parse(customerContacts));
                            }
                        }, {
                            escape : true
                    });
                    return deferred.promise;
            }
            
            // Add/Update method for a customer contact to add in related customer contacts list
            this.addCustomerContact= function(customerCotnactJSON)
            {
                    customerCotnactJSON = encodeString(angular.toJson(customerCotnactJSON));
                    var deferred = $q.defer();
                    Visualforce.remoting.Manager.invokeAction(
                        '{!$RemoteAction.ViewCustomerCtrl.updateCustomerContact}',
                        customerCotnactJSON,
                        function (result, event) {
                           if (event.type == 'exception') {
                                deferred.reject(event.message);
                            } else {
                                var customerContacts = decodeString(result);
                                var find = '\'';
                                var re = new RegExp(find, 'g');
                                customerContacts = customerContacts.replace(re, '');
                                deferred.resolve(JSON.parse(customerContacts));
                            }
                        }, {
                            escape : true
                    });
                    return deferred.promise;
            }
            
            // Add/Update method for a customer contact to add in related customer contacts list
            this.updateRelation = function(customerCotnactJSON)
            {
                    customerCotnactJSON = encodeString(angular.toJson(customerCotnactJSON));
                    var deferred = $q.defer();
                    Visualforce.remoting.Manager.invokeAction(
                        '{!$RemoteAction.ViewCustomerCtrl.updateCustomerContactRelation}',
                        customerCotnactJSON,
                        function (result, event) {
                           if (event.type == 'exception') {
                                deferred.reject(event.message);
                            } else {
                                var customerContacts = decodeString(result);
                                var find = '\'';
                                var re = new RegExp(find, 'g');
                                customerContacts = customerContacts.replace(re, '');
                                deferred.resolve(JSON.parse(customerContacts));
                            }
                        }, {
                            escape : true
                    });
                    return deferred.promise;
            }
            
            // Remove method of Customer Contact Record
            this.removeCustomerContact = function(customerId, customerContactId) {
                 customerId = encodeString(customerId);
                 customerContactId = encodeString(customerContactId);
                 var deferred = $q.defer();
                 Visualforce.remoting.Manager.invokeAction(
                    '{!$RemoteAction.ViewCustomerCtrl.removeCustomerContactRecord}',
                            customerId, customerContactId,
                     function (result, event) {
                        if (event.type == 'exception') {
                             deferred.reject(event.message);
                         } else {
                             var customerContactRec = decodeString(result);
                             var find = '\'';
                             var re = new RegExp(find, 'g');
                             customerContactRec = customerContactRec.replace(re, '');
                             deferred.resolve(JSON.parse(customerContactRec));
                         }
                     }, {
                         escape : true
                 });
                 return deferred.promise;
            }
        });
        
        </script>
     
     <body ng-controller="ViewCustomer" ng-init="ViewCustomer.loadCustomerInfo()">
        <!-- Header start -->
		<div ng-if="ViewCustomer.showAllData ==0" class="errorPageDiv">
            <h1> {!$Label.Customer_Not_Found} </h1>
            <h4> Click here to go <a href="{!$Page.HomeSearch}"> HOME </a> </h4>
        </div>
        <c:BPGlobalHeader />
        
        <!-- Header End -->
        <!-- content start here -->
        <div  ng-if="ViewCustomer.ShowContent">
            <div class="row" >

                <!-- Side panel start -->   
                <div class="col-lg-2 col-md-2 col-sm-2 sidepanel" id="workflow-sidepanel">
                    <div class="row customerAvatar leftpanelrow handCursor" >
                        <h2>
                            <img src="{!URLFOR($Resource.Images, 'gold.png')}"/>
                        </h2>
                        <i class="fa fa-star"></i>
                        <i class="fa fa-star"></i>
                    </div>
                    
                    <div class="row customerAvatar customerStatus leftpanelrow" style="margin-top: 3px;">
                        <span ng-if="ViewCustomer.CustomerInfo.CustomerInfo.Active"><b>ACTIVE</b></span>
                        <span ng-if="!ViewCustomer.CustomerInfo.CustomerInfo.Active"><b>INACTIVE</b></span>
                    </div>
                    
                    <div class="row leftpanelrow nameDiv">
                        <h3 style="font-size: 21px;" ng-if="ViewCustomer.CustomerInfo.CustomerInfo.Type == 'Individual'" title="{{ViewCustomer.CustomerInfo.CustomerInfo.FirstName}} {{ViewCustomer.CustomerInfo.CustomerInfo.LastName}}"> {{ViewCustomer.CustomerInfo.CustomerInfo.FirstName}} {{ViewCustomer.CustomerInfo.CustomerInfo.LastName}}</h3>
                        <h3 style="font-size: 21px;" ng-if="ViewCustomer.CustomerInfo.CustomerInfo.Type != 'Individual'" title="{{ViewCustomer.CustomerInfo.CustomerInfo.BusinessName}}"> {{ViewCustomer.CustomerInfo.CustomerInfo.BusinessName}}</h3>
                    </div>
                    
                    <div style="margin-top: 0" class="row leftpanelrow" ng-if="ViewCustomer.CustomerInfo.CustomerInfo.Type == 'Individual' && ViewCustomer.CustomerInfo.CustomerInfo.Nickname != ''">
                        <h4 style="font-size: 19px;">"{{ViewCustomer.CustomerInfo.CustomerInfo.Nickname}}"</h4>
                    </div>
                    
                    <div class="row leftpanelrow" style="margin-top: 5px;">
                        <h4 style="font-size: 17px;">{{ViewCustomer.CustomerInfo.CustomerInfo.Type}}</h4>
                    </div>  
                    
                    <div class="row leftpanelrow icnos">
                        <a href="{{ViewCustomer.CustomerInfo.CustomerInfo.FacebookLink}}" target="_blank" ng-if="ViewCustomer.CustomerInfo.CustomerInfo.FacebookLink != ''">
                            <i class="fa fa-facebook-square" style="color: #45619D;"> </i> 
                        </a>
                        <a href="{{ViewCustomer.CustomerInfo.CustomerInfo.TwitterLink}}" target="_blank" ng-if="ViewCustomer.CustomerInfo.CustomerInfo.TwitterLink != ''">
                            <i class="fa fa-twitter-square"  style="color: #52A7E7;"></i> 
                        </a>
                        <a href="{{ViewCustomer.CustomerInfo.CustomerInfo.LinkedInLink}}" target="_blank" ng-if="ViewCustomer.CustomerInfo.CustomerInfo.LinkedInLink != ''">
                            <i class="fa fa-linkedin-square"  style="color: #007bb6;"></i> 
                        </a>
                    </div>
                    
                    <div class="row sections-link" id="workflow-actions">
                        <div class="heading">
                            <a href="#Info_Section" rel="#Info_Section" ng-click="ViewCustomer.setHighlightedSection = 'Info'">
                                <span class="link" ng-class="{'orange': ViewCustomer.setHighlightedSection == 'Info'}">A &nbsp; Info </span>
                            </a>
                        </div>
                        <div class="heading">
                            <a href="#Vital_Statistics" rel="#Statistics_Section" ng-click="ViewCustomer.setHighlightedSection = 'Statistics'">
                                <span ng-class="{'orange': ViewCustomer.setHighlightedSection == 'Statistics'}">B &nbsp; Statistics </span>
                            </a>    
                        </div>
                        
                        <div class="sub-heading">
                            <a href="#Vital_Statistics" rel="#Statistics_Section" ng-click="ViewCustomer.setHighlightedSection = 'VitalStatistics'">
                                <span class="link" ng-class="{'orange': ViewCustomer.setHighlightedSection == 'VitalStatistics'}">Vital Statistics</span>
                            </a>
                        </div>
                        <div class="sub-heading">
                            <a href="#Telemetry" rel="#Statistics_Section" ng-click="ViewCustomer.setHighlightedSection = 'Telementry'">
                                <span class="link" ng-class="{'orange': ViewCustomer.setHighlightedSection == 'Telementry'}">Telementry</span>
                            </a>
                        </div>
                        
                        <div class="heading">
                            <a href="#CM_Owned_Units_block_heading_panel" rel="#Related" ng-click="ViewCustomer.setHighlightedSection = 'Related'">
                                <span ng-class="{'orange': ViewCustomer.setHighlightedSection == 'Related'}">C &nbsp; Related </span>
                            </a>
                        </div>
                        <div class="sub-heading">
                            <a href="#CM_Owned_Units_block_heading_panel" rel="#Related" ng-click="ViewCustomer.setHighlightedSection = 'COU'">
                                <span class="link" ng-class="{'orange': ViewCustomer.setHighlightedSection == 'COU'}">Customer Owned Units</span>
                            </a>
                        </div>
                        <div class="sub-heading">
                            <a href="#CM_Customers_block_heading_panel" rel="#Related" ng-click="ViewCustomer.setHighlightedSection = 'Customers'">
                                <span class="link" ng-class="{'orange': ViewCustomer.setHighlightedSection == 'Customers'}">Customers</span>
                            </a>
                        </div>
                        <div class="sub-heading" ng-if="ViewCustomer.CustomerInfo.CustomerInfo.Type != 'Individual'" >
                            <a href="#CM_Contacts_block_heading_panel" rel="#Related" ng-click="ViewCustomer.setHighlightedSection = 'Contacts'">
                                <span class="link" ng-class="{'orange': ViewCustomer.setHighlightedSection == 'Contacts'}">Contacts</span>
                            </a>
                        </div>
                        <!-- <div class="heading">
                            <a href="#Activity Stream" rel="#Deposits_block">
                                <span class="link">D &nbsp; Activity Stream </span>
                            </a>
                        </div> -->
                    </div>
                    
                   
                    
                </div>
                <div class="col-lg-10 col-md-10 col-sm-10 topPadding" style="position: absolute; top: 30px; right: 0;">
                    <div class="row sub-search-row" id="fixed-seacrh-row">
                        <div class="col-lg-4 col-md-4 order-number" style="font-size: 0px;">
                            <span>
                            	<h2 ng-if="ViewCustomer.CustomerInfo.CustomerInfo.Type == 'Individual'" > {{ViewCustomer.CustomerInfo.CustomerInfo.FirstName}} {{ViewCustomer.CustomerInfo.CustomerInfo.LastName}}</h2>
                            	<h2 ng-if="ViewCustomer.CustomerInfo.CustomerInfo.Type != 'Individual'" > {{ViewCustomer.CustomerInfo.CustomerInfo.BusinessName}}</h2>
                            </span>
                        </div>
                        <div class="col-lg-5 col-md-5 col-sm-5 col-xs-5 sub-search">
                             <div class="padded-row" style="width:100%">
                                 <c:SearchToAdd />
                            </div>  

                        </div>
                        <div class="new-div">
                            <a href="">New</a>
                        </div>
                        <div class="editBtn">
                            <button class="square-btn bold white orange-back" ng-click="ViewCustomer.editCustomerDetails()">Edit</button>
                        </div>
                        <div class="icons-div pull-right">
                            <div>
                                <a href=""><i class="fa fa-floppy-o"></i></a>
                            </div>   
                            <div>
                                <a aria-expanded="false" class="dropdown-toggle" data-toggle="dropdown" href="#" role="button">
                                    <span class="fa fa-cog"></span>
                                </a>
                                <ul class="link_dropdown dropdown-menu" role="menu">
                                    <li><a href="" ng-click="setFocusToSearchBox()">Grid Search</a></li>
                                    <li><a href="">Convert to Quote</a></li>
                                    <li><a href="">Delete Customer Order</a></li>
                                </ul>
                            </div>    
                        </div>
                    </div>
                    
                    <div class="clearfix" style="height:25px;"></div>
                    
                    <div class="row dynamic_heading heading_panel divDisplayNone" id="sticky-heading"> 
                       <div class="row" style="height: 30px; background-color: white"> </div>
                       
                       <div id="CO_dynamic_heading_panel_left_heading" class="left_heading col-lg-10 col-md-10">
                           <h1 id="CO_dynamic_heading_panel_left_heading_h1">
                                
                           </h1>
                       </div>
                    </div>
                    
                    <div class="content" id="scrollable">
                         <div id="Info_Section">
                            <div class="heading_panel row" style="margin-top : -15px;">
                                <div class="left_heading col-lg-12 col-md-12">
                                    <h1>
                                        <span class="heading_icon handCursor" ng-click="ViewCustomer.hidePanel($event, 'Info_block')">
                                            <i class="fa fa-chevron-right"></i>
                                        </span>
                                        A Info 
                                        <i class="fa fa-question-circle question_mark" data-toggle="tooltip" title="{{ViewCustomer.helpText['Info']}}"></i>
                                    </h1>
                                </div>
                            </div>
                            <div Class="Info_block">
                                <div class="row">
                                    <div class="col-lg-3 col-md-3">
                                        <div class="row">
                                            <div class="col-lg-12 col-md-12 form-group">
                                                <label for="labelFirstName">SEND EMAIL  <i class="fa fa-star orange" ></i></label>
                                                <p class="blue"  ng-bind="ViewCustomer.setPrefferedEmail()"> </p>
                                            </div>
                                        </div>
                                        
                                        <div class="row">
                                            <div class="col-lg-6 col-md-6 form-group">
                                                <label for="labelFirstName">{{ViewCustomer.infoLabel[ViewCustomer.CustomerInfo.CustomerInfo.PreferredPhoneLabel] | uppercase}} <i class="fa fa-star orange" ></i></label>
                                                <p class="blue" ng-bind="ViewCustomer.setPrefferedPhone()"> </p>
                                            </div>
                                            <div class="col-lg-6 col-md-6 form-group">
                                                <label for="labelFirstName">{{ViewCustomer.infoLabel[ViewCustomer.CustomerInfo.CustomerInfo.PreferredSMSLabel] | uppercase}}  <i class="fa fa-star orange" ></i></label>
                                                <p class="blue"  ng-bind="ViewCustomer.setPrefferedSMS()">  </p>
                                            </div>
                                        </div>
                                        
                                        
                                       <div ng-show="ViewCustomer.ShowMore==false" class="MoreSectionContent animate-showContent"> 
                                        <div class="row" >
                                            <div class="col-lg-12 col-md-12 form-group" ng-show="ViewCustomer.CustomerInfo.CustomerInfo.PreferredEmail != 'HomeEmail' && ViewCustomer.CustomerInfo.CustomerInfo.Type == 'Individual'  &&  ViewCustomer.CustomerInfo.CustomerInfo.PreferredEmail != ''  && ViewCustomer.CustomerInfo.CustomerInfo.HomeEmail != ''">
                                                <label for="labelFirstName">EMAIL HOME  <i class="fa fa-star white" ></i></label>
                                                <p class="blue"> {{ViewCustomer.CustomerInfo.CustomerInfo.HomeEmail}} </p>
                                            </div>
                                        </div>
                                        
                                         <div class="row" >
                                            <div class="col-lg-12 col-md-12 form-group" ng-show="ViewCustomer.CustomerInfo.CustomerInfo.PreferredEmail != 'WorkEmail' && ViewCustomer.CustomerInfo.CustomerInfo.Type == 'Business' && ViewCustomer.CustomerInfo.CustomerInfo.WorkEmail != ''">
                                                <label for="labelFirstName">EMAIL WORK  <i class="fa fa-star white" ></i></label>
                                                <p class="blue"> {{ViewCustomer.CustomerInfo.CustomerInfo.WorkEmail}} </p>
                                            </div>
                                        </div>
                                        
                                        <div class="row" >
                                            <div class="col-lg-12 col-md-12 form-group" ng-show="ViewCustomer.CustomerInfo.CustomerInfo.PreferredEmail != 'OtherEmail' && ViewCustomer.CustomerInfo.CustomerInfo.OtherEmail != ''">
                                                <label for="labelFirstName">EMAIL OTHER  <i class="fa fa-star white" ></i></label>
                                                <p class="blue"> {{ViewCustomer.CustomerInfo.CustomerInfo.OtherEmail}} </p>
                                            </div>
                                        </div>
                                        
                                        
                                        <div class="row" ng-show="ViewCustomer.CustomerInfo.CustomerInfo.Type == 'Individual'">
                                            <div class="col-lg-6 col-md-6 form-group" ng-show="ViewCustomer.CustomerInfo.CustomerInfo.PreferredPhoneLabel != 'HomeNumber' && ViewCustomer.CustomerInfo.CustomerInfo.HomeNumber != ''">
                                                <label for="labelFirstName">CALL HOME  <i class="fa fa-star white" ></i></label>
                                                <p class="blue"> {{ViewCustomer.CustomerInfo.CustomerInfo.HomeNumber}} </p>
                                            </div>
                                            <div class="col-lg-6 col-md-6 form-group" ng-show="ViewCustomer.CustomerInfo.CustomerInfo.PreferredSMSLabel != 'HomeNumberSMS' && ViewCustomer.CustomerInfo.CustomerInfo.HomeNumber != ''">
                                                <label for="labelFirstName">SMS HOME  <i class="fa fa-star white" ></i></label>
                                                <p class="blue" ng-show="ViewCustomer.CustomerInfo.CustomerInfo.HomeNumberSMS==true"> {{ViewCustomer.CustomerInfo.CustomerInfo.HomeNumber}}</p>
                                            </div>
                                        </div>
                                        
                                         <div class="row" ng-show="ViewCustomer.CustomerInfo.CustomerInfo.Type == 'Business'">
                                            <div class="col-lg-6 col-md-6 form-group" ng-show="ViewCustomer.CustomerInfo.CustomerInfo.PreferredPhoneLabel != 'WorkNumber' && ViewCustomer.CustomerInfo.CustomerInfo.WorkNumber != ''">
                                                <label for="labelFirstName" >CALL WORK  <i class="fa fa-star white" ></i></label>
                                                <p class="blue"> {{ViewCustomer.CustomerInfo.CustomerInfo.WorkNumber}} </p>
                                            </div>
                                            <div class="col-lg-6 col-md-6 form-group" ng-show="ViewCustomer.CustomerInfo.CustomerInfo.PreferredSMSLabel != 'WorkNumberSMS' && ViewCustomer.CustomerInfo.CustomerInfo.WorkNumber != ''">
                                                <label for="labelFirstName" ng-show="ViewCustomer.CustomerInfo.CustomerInfo.PreferredPhoneLabel != 'WorkNumberSMS'">SMS WORK<i class="fa fa-star white" ></i></label>
                                                <p class="blue"> {{ViewCustomer.CustomerInfo.CustomerInfo.WorkNumber}} </p>
                                            </div>
                                        </div>
                                        
                                        
                                        <div class="row" >
                                            <div class="col-lg-6 col-md-6 form-group" ng-show="ViewCustomer.CustomerInfo.CustomerInfo.PreferredPhoneLabel != 'MobileNumber' && ViewCustomer.CustomerInfo.CustomerInfo.OtherPhone != ''">
                                                <label for="labelFirstName">CALL OTHER  <i class="fa fa-star white" ></i></label>
                                                <p class="blue"> {{ViewCustomer.CustomerInfo.CustomerInfo.OtherPhone}} </p>
                                            </div>
                                            <div class="col-lg-6 col-md-6 form-group" ng-show="ViewCustomer.CustomerInfo.CustomerInfo.PreferredSMSLabel != 'MobileNumberSMS' && ViewCustomer.CustomerInfo.CustomerInfo.OtherPhone != ''">
                                                <label for="labelFirstName">SMS OTHER  <i class="fa fa-star white" ></i></label>
                                                <p class="blue" ng-show="ViewCustomer.CustomerInfo.CustomerInfo.MobileNumberSMS==true"> {{ViewCustomer.CustomerInfo.CustomerInfo.OtherPhone}}</p>
                                            </div>
                                        </div>
                                        
                                      </div>
                                        
                                    </div>
                                    <div class="col-lg-4 col-md-4"  >
                                        <div class="row" style="padding-left:15px;padding-right:15px">
                                            <div class="col-lg-12 col-md-12 ActiveAdress" ng-show="ViewCustomer.CustomerInfo.CustomerInfo.IsBothAddressSame" style="text-align:center">
                                                    Address
                                            </div>
                                            <div class=" col-lg-6 col-md-6" ng-show="!ViewCustomer.CustomerInfo.CustomerInfo.IsBothAddressSame" style="text-align:center"  ng-click="ViewCustomer.changeActiveAddress('BillingAddress')" ng-class="{ ActiveAdress: ViewCustomer.activeAddress=='BillingAddress' ,  InactiveAdress: ViewCustomer.activeAddress=='ShippingAddress'}">
                                                    Billing  
                                            </div>
                                            <div class=" col-lg-6 col-md-6" ng-show="!ViewCustomer.CustomerInfo.CustomerInfo.IsBothAddressSame" style="text-align:center" ng-click="ViewCustomer.changeActiveAddress('ShippingAddress')"  ng-class="{ ActiveAdress: ViewCustomer.activeAddress=='ShippingAddress' , InactiveAdress: ViewCustomer.activeAddress=='BillingAddress'}">
                                                    Shipping
                                            </div>
                                        </div>
                                    <div class="row" >
                                        <div class=" col-lg-12 col-md-12" >
                                              <map zoom="14" center="37.7699298, -122.4469157" style="height:300px " >
                                                <directions 
                                                  draggable="false"
                                                  panel="directions-panel" 
                                                  travel-mode="DRIVING"
                                                  origin="280,Nelson Street,Vancouver"
                                                  destination="{{ViewCustomer.addressOnMap}}">
                                                </directions>
                                             </map> 
                                             
                                        </div>
                                            
                                        </div>
                                        <div class="row">
                                            <div class=" col-lg-12 col-md-12">
                                            <div class="form-group">
                                                <label for="labelFirstName">Address </label>
                                                <div style="width:100%; min-height:50px" > {{ViewCustomer.addressOnMap}}</div>
                                            </div>
                                        </div>
                                        </div>
                                        
                                    </div>
                                    <div class="col-lg-5 col-md-5">
                                    
                                               <!-- calender section -->
                                    
                                    
                                             <div class="calendar-container">
                                                <div class="calendar">
                                                    <header>
                                                        <h2 class="month"></h2>
                                                        <a class="btn-prev fontawesome-angle-rigt" href="#">
                                                        <i  class="fa fa-chevron-left orange" style="position: relative;margin-top: 3px;margin: 13px;"></i>
                                                        </a>
                                                        <a class="btn-next fontawesome-angle-right" href="#">
                                                        <i  class="fa fa-chevron-right orange" style="position: relative;margin-top: 3px;margin: 13px;"></i>
                                                        </a>
                                                    </header>
                                                    <table>
                                                        <thead class="event-days">
                                                            <tr></tr>
                                                        </thead>
                                                        <tbody class="event-calendar">
                                                            <tr class="1"></tr>
                                                            <tr class="2"></tr>
                                                            <tr class="3"></tr>
                                                            <tr class="4"></tr>
                                                            <tr class="5"></tr>
                                                        </tbody>
                                                    </table>
                                                </div>
                                            </div>
                                        
                                                                        
                                    
                                    
                                    
                                    <!-- End section -->
                                    </div>
                                </div>
                                 
                               
                                
                                <div class="row MoreSectionContent animate-showContent" ng-show="ViewCustomer.ShowMore==false" >
                                <div class="row">
                                    <div class="col-lg-3 col-md-3 form-group"  ng-show="ViewCustomer.CustomerInfo.CustomerInfo.JobTitle != ''">
                                                     <label for="labelFirstName">JOB TITLE </label>
                                                    <p> {{ViewCustomer.CustomerInfo.CustomerInfo.JobTitle}} </p>
                                    </div>  
                                    
                                    <div class="col-lg-3 col-md-3 form-group" ng-show="ViewCustomer.CustomerInfo.CustomerInfo.Company != ''">
                                                     <label for="labelFirstName">COMPANY </label>
                                                    <p> {{ViewCustomer.CustomerInfo.CustomerInfo.Company}} </p>
                                    </div>  
                                    
                                     <div class="col-lg-3 col-md-3 form-group" ng-show="ViewCustomer.CustomerInfo.CustomerInfo.Birthdate != null">
                                                     <label for="labelFirstName">BIRTHDAY  <i class="fa fa-birthday-cake orange"></i></label>
                                                    <p> {{ViewCustomer.CustomerInfo.CustomerInfo.Birthdate | date:'MMM d, y'}} </p>
                                        
                                    </div>
                                    
                                    <div class="col-lg-3 col-md-3 form-group" >
                                                     <label for="labelFirstName">VIP LEVEL </label>
                                                    <p> Gold</p>
                                    </div>
                                    
                                    
                                    
                                    
                                      <div class="col-lg-3 col-md-3 form-group" ng-show="ViewCustomer.CustomerInfo.CustomerInfo.SalesTaxName != ''">
                                                     <label for="labelFirstName">SALES TAX </label>
                                                     <p> {{ViewCustomer.CustomerInfo.CustomerInfo.SalesTaxName}} </p>
                                    </div>
                                    
                                     <div class="col-lg-3 col-md-3 form-group" ng-show="ViewCustomer.CustomerInfo.CustomerInfo.PriceLevelName != ''">
                                                     <label for="labelFirstName">PRICE LEVEL </label>
                                                     <p> {{ViewCustomer.CustomerInfo.CustomerInfo.PriceLevelName}} </p>
                                    </div>
                                    
                                    <div class="col-lg-3 col-md-3 form-group" ng-show="ViewCustomer.CustomerInfo.CustomerInfo.PurchaseTaxName != ''">
                                                     <label for="labelFirstName">VENDOR TAX </label>
                                                     <p> {{ViewCustomer.CustomerInfo.CustomerInfo.PurchaseTaxName}} </p>
                                    </div>
                                    
                                    </div>
                                  
                                 </div>  
                                
                                
                            </div>
                            <div class="row MoreButton">
                                    <div Class=" col-lg-12 col-md-12">
                                            <div ng-show="ViewCustomer.ShowMore ==true" ng-click="ViewCustomer.showMoreDetails(false)">Show More..</div>
                                            <div ng-show="ViewCustomer.ShowMore== false" ng-click="ViewCustomer.showMoreDetails(true)">Show Less..</div>
                                    </div>
                            </div>
                        </div> 
                        
                       <div id="Statistics_Section" class="row statisticsSection">
                            <div class="heading_panel row">
                                <div class="left_heading col-lg-12 col-md-12">
                                    <h1>
                                        <span class="heading_icon handCursor" ng-click="ViewCustomer.hidePanel($event, 'Vital_Statistics')">
                                            <i class="fa fa-chevron-right"></i>
                                        </span>
                                        B Statistics
                                        <i class="fa fa-question-circle question_mark" data-toggle="tooltip" title="{{ViewCustomer.helpText['Statistics']}}"></i>
                                    </h1>
                                </div>
                            </div>
                            
                            <div id="Vital_Statistics" class="heading_panel_sub col-lg-12 col-md-12" style="border-left: 3px solid orange; padding-left: 20px;">
                                <div class="row">
                                    <div class="left_sub col-lg-5 col-md-5" >
                                        <h1>
                                            <span class="subheading_text">Vital Statistics </span>
                                            <i class="fa fa-question-circle question_mark" data-toggle="tooltip" title="{{ViewCustomer.helpText['Vital_Statistics']}}"></i>
                                        </h1>
                                    </div>
                                    
                                    <div class="col-lg-7 col-md-7">
                                        <div class="right_sub pull-right" id="CM_Owned_Units_block_heading_panel_right_sub">
                                            <button class="action_btn btn" id="CM_Owned_Units_block_heading_panel_right_sub_action_btn">Actions</button>
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="row">
                                    <div class="col-lg-2 col-md-2 tiles">
                                        <div class="innerTiles">
                                            <h3 ng-if="ViewCustomer.CustomerInfo.OrdersLifetime != null"> {{ViewCustomer.CustomerInfo.OrdersLifetime}} </h3>
                                            <h3 ng-if="ViewCustomer.CustomerInfo.OrdersLifetime == null"> 0 </h3>
                                            <p> Orders Lifetime </p>
                                        </div>
                                    </div>
                                    
                                    <div class="col-lg-2 col-md-2 tiles">
                                        <div class="innerTiles">
                                            <h3 ng-if="ViewCustomer.CustomerInfo.OpenOrders != null"> {{ViewCustomer.CustomerInfo.OpenOrders}} </h3>
                                            <h3 ng-if="ViewCustomer.CustomerInfo.OpenOrders == null"> 0 </h3>
                                            <p> Open Orders </p>
                                        </div>
                                    </div>
                                    
                                    <div class="col-lg-2 col-md-2 tiles">
                                        <div class="innerTiles">
                                            <h3 ng-if="ViewCustomer.CustomerInfo.AverageSpendPerHour != null"> {{ViewCustomer.CustomerInfo.AverageSpendPerHour | number : 2}} </h3>
                                            <h3 ng-if="ViewCustomer.CustomerInfo.AverageSpendPerHour == null"> 0 </h3>
                                            <p> Average Spend per Order</p>
                                        </div>
                                    </div>
                                    
                                    <div class="col-lg-2 col-md-2 tiles">
                                        <div class="innerTiles">
                                            <h3 ng-if="ViewCustomer.CustomerInfo.LastVisit != ''"> {{ViewCustomer.CustomerInfo.LastVisit}} </h3>
                                            <h3 ng-if="ViewCustomer.CustomerInfo.LastVisit == ''"> 0 </h3>
                                            <p> Last Visit </p>
                                        </div>
                                    </div>
                                    
                                    <div class="col-lg-2 col-md-2 tiles">
                                        <div class="innerTiles">
                                            <h3> 97% </h3>
                                            <p> Event Attendance </p>
                                        </div>
                                    </div>
                                    
                                    <div class="col-lg-2 col-md-2 tiles">
                                        <div class="innerTiles">
                                            <h3> 39% </h3>
                                            <p> Upsell Success </p>
                                        </div>
                                    </div>
                                </div>
                                
                                <div style="height: 50px;">
                                
                                </div>
                                
                                <div class="row" id="Telemetry">
                                    <div class="left_sub col-lg-5 col-md-5"  >
                                        <h1>
                                            <span class="subheading_text">Telemetry </span>
                                            <i class="fa fa-question-circle question_mark" data-toggle="tooltip" title="{{ViewCustomer.helpText['Telemetry']}}"></i>
                                        </h1>
                                    </div>
                                    
                                    <div class="col-lg-7 col-md-7">
                                        <div class="right_sub pull-right" id="CM_Owned_Units_block_heading_panel_right_sub">
                                            <button class="action_btn btn" id="CM_Owned_Units_block_heading_panel_right_sub_action_btn">Actions</button>
                                        </div>
                                    </div>
                                </div>
                                
                            </div>
                        </div>          
                        <div class="clearfix" style="height:15px;"></div>
                        
                         <div id="Related" >
                            <div class="heading_panel row">
                                <div class="left_heading col-lg-12 col-md-12">
                                    <h1>
                                        <span class="heading_icon handCursor" ng-click="ViewCustomer.hidePanel($event, 'relatedSection')">
                                            <i class="fa fa-chevron-right"></i>
                                        </span>
                                        C Related
                                        <i class="fa fa-question-circle question_mark" data-toggle="tooltip" title="{{ViewCustomer.helpText['Related']}}"></i>
                                    </h1>
                                </div>
                            </div>
                            
                            <!-- START: Customer Owned Units data table -->
                            <div id="relatedSection" >
                             <div class="heading_panel_sub col-lg-12 col-md-12" id="CM_Owned_Units_block_heading_panel"  ng-click="ViewCustomer.closeEditCustomerOwnedUnitRows($event)">
                                <div class="left_sub col-lg-5 col-md-5" id="CM_Owned_Units_block_heading_panel_left_sub">
                                    <h1 id="CM_Owned_Units_block_heading_panel_left_sub_h1">
                                        <span class="subheading_text" id="CM_Owned_Units_block_heading_panel_left_sub_h1_text">Customer Owned Units</span> 
                                        <i class="fa fa-plus-square plush_sign handCursor" id="CM_Owned_Units_block_heading_panel_left_sub_h1_text_plus_icon" ng-click="ViewCustomer.openAddCustomerOwnedUnitPopup($event)"></i> 
                                        <i class="fa fa-question-circle question_mark" data-toggle="tooltip" title="{{ViewCustomer.helpText['COU']}}"></i>
                                    </h1>
                                </div>
                                <div class="right_sub pull-right" id="CM_Owned_Units_block_heading_panel_right_sub">
                                    <button id="CM_Owned_Units_block_heading_panel_right_sub_action_btn" class="action_btn btn">Actions</button>
                                </div>
                                <div style="border-bottom : 1px solid black; margin-top: 40px; width: 101%"></div>
                            </div>
                            
                            <div class="gid_container" id="Customer_Owned_Units" >
                                <table class="table" id="CM_Owned_UnitsGrid">
                                    <col width="4%"  />
                                    <col width="4%"  />
                                    <col width="30%" />
                                    <col width="7%"  />
                                    <col width="13%" />
                                    <col width="10%" />
                                    <col width="10%"  />
                                    <col width="10%" />
                                    <col width="12%"  />
                                    <tr ng-click="ViewCustomer.closeEditCustomerOwnedUnitRows($event)" class="tableHeader">
                                        <th></th>
                                        <th>YEAR</th>
                                        <th>MAKE</th>
                                        <th>MODEL</th>
                                        <th>SUB MODEL</th>
                                        <th>VIN</th>
                                        <th>PLATE</th>
                                        <th>MILEAGE</th>
                                        <th>COLOR</th>
                                    </tr>
                                    <tbody ng-repeat="ownedUnit in ViewCustomer.CMOwnedUnits" >
                                        <!-- Display rows -->
                                        <tr class="clickable_row" id="row1" rel="owned_unit_row{{$index}}_edit"  ng-click="ViewCustomer.editOwnedUnit($event, $index)"
                                            ng-blur = "ViewCustomer.editOwnedUnit($event, $index)" >
                                            <td id="CM_Owned_Units_block_grid_container_tbody_tr_td_1_{{$index}}">
                                                <a href="" class="edite_btn" rel="row1_edit">
                                                    <img src="{!URLFOR($Resource.icon_images, 'images/editicon.png')}" />
                                                </a>
                                            </td>
                                            <td id="CM_Owned_Units_block_grid_container_tbody_tr_td_2_{{$index}}">  <span>{{ownedUnit.Year}}</span> </td>
                                            <td id="CM_Owned_Units_block_grid_container_tbody_tr_td_3_{{$index}}">  <u>{{ownedUnit.MakeName}}</u>   </td>
                                            <td id="CM_Owned_Units_block_grid_container_tbody_tr_td_4_{{$index}}">  {{ownedUnit.ModelName}} </td>
                                            <td id="CM_Owned_Units_block_grid_container_tbody_tr_td_5_{{$index}}">  {{ownedUnit.SubModelName}}      </td>
                                            <td id="CM_Owned_Units_block_grid_container_tbody_tr_td_6_{{$index}}" > {{ownedUnit.VIN}}           </td>
                                            <td id="CM_Owned_Units_block_grid_container_tbody_tr_td_7_{{$index}}">  {{ownedUnit.Plate}}         </td>
                                            <td id="CM_Owned_Units_block_grid_container_tbody_tr_td_8_{{$index}}">  {{ownedUnit.Mileage}}       </td>
                                            <td id="CM_Owned_Units_block_grid_container_tbody_tr_td_9_{{$index}}">  {{ownedUnit.Color}}     </td>
                                        </tr>
                                        
                                        <!-- Actions row in case editable row -->
                                        <tr ng-show="ViewCustomer.CMOwnedUnits_editRow[$index].isEdit" class="edit_panel sample-show-hide" id="owned_unit_row{{$index}}_edit">
                                            <td colspan="9" id="CM_Owned_Units_block_grid_container_tbody_expandtr_td_1_{{$index}}">
                                                <div id="CM_Owned_Units_block_grid_container_tbody_expandtr_edit_box_{{$index}}" class="edit_box col-lg-9 col-md-9" ng-show="ViewCustomer.CMOwnedUnits_editRow[$index].isEdit">
                                                    <div class="its-heading" id="CM_Owned_Units_block_grid_container_tbody_expandtr_edit_box_its-heading_{{$index}}">
                                                        <img src="{!URLFOR($Resource.icon_images, 'images/edit_icon.png')}" styleClass="img_action"/>
                                                        <span>Actions (4 Available)</span>
                                                    </div>
                                                    <div id="CM_Owned_Units_block_grid_container_tbody_expandtr_edit_box_its-heading_edit-body_{{$index}}" class="edit-body">
                                                        <form>
                                                            <!-- Edit link as action -->
                                                            <div class="radio" id="CM_Owned_Units_block_grid_container_tbody_expandtr_edit_box_its-heading_edit-body_{{$index}}_radio_1">
                                                                <label>
	                                                                <input type="radio" name="optionsRadios" id="optionsRadios1" value="1"
	                                                                    ng-model= "ViewCustomer.CMOwnedUnits_editRow[$index].radioValue"/>
	                                                                <span>
								                                        <i class="fa fa-pencil-square-o"></i>
								                                        Edit
								                                    </span>
                                                                </label>
                                                            </div>
                                                            
                                                            <!-- Schedule Service as action -->
                                                            <div class="radio" id="CM_Owned_Units_block_grid_container_tbody_expandtr_edit_box_its-heading_edit-body_{{$index}}_radio_2">
                                                                <label>
	                                                                <input type="radio" name="optionsRadios" id="optionsRadios2" value="2"
	                                                                    ng-model= "ViewCustomer.CMOwnedUnits_editRow[$index].radioValue"/>
	                                                                <span>
								                                        <i class="fa fa-pencil-square-o"></i>
								                                        Schedule Service
								                                    </span>
                                                                </label>
                                                            </div>
                                                            
                                                            <!-- Transfer to another customer as action -->
                                                            <div class="radio" id="CM_Owned_Units_block_grid_container_tbody_expandtr_edit_box_its-heading_edit-body_{{$index}}_radio_3">
                                                                <label>
	                                                                <input type="radio" name="optionsRadios" id="optionsRadios3" value="3"
	                                                                    ng-model= "ViewCustomer.CMOwnedUnits_editRow[$index].radioValue"/>
	                                                                <span>
								                                        <i class="fa fa-pencil-square-o"></i>
								                                        Transfer to another customer
								                                    </span>
                                                                </label>
                                                            </div>
                                                            
                                                            <!-- Remove link as action -->
                                                            <div class="radio" id="CM_Owned_Units_block_grid_container_tbody_expandtr_edit_box_its-heading_edit-body_{{$index}}_radio_4">
                                                                <label>
	                                                                <input type="radio" name="optionsRadios" id="optionsRadios4" value="4"
	                                                                    ng-model= "ViewCustomer.CMOwnedUnits_editRow[$index].radioValue"/>
	                                                                <span>
								                                        <i class="fa fa-times"></i>
								                                        Remove Link
								                                    </span>
                                                                </label>
                                                            </div>
                                                            
                                                            <!-- Action button (Go) -->
                                                            <a href="" id="CM_Owned_Units_block_grid_container_tbody_expandtr_edit_box_its-heading_edit-body_{{$index}}_go_btn" 
                                                                class="btn btn-default editform_btn" role="button"
                                                                ng-click="ViewCustomer.CM_OwnedUnits_GoAction($index)"> Go  </a>                                
                                                        </form>
                                                    </div>
                                                    <a href="" class="faq_link">
                                                    <i class="fa fa-question-circle qmark"></i>
                                                    </a>
                                                </div>
                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                            <!-- END: Customer Owned Units data table -->
                            
                            <!-- START: Related Customers list section -->
                            <div class="heading_panel_sub col-lg-12 col-md-12" id="CM_Customers_block_heading_panel" ng-click="ViewCustomer.closeEditCustomerRows($event)">
                                <div class="left_sub col-lg-5 col-md-5" id="CM_Customers_block_heading_panel_left_sub">
                                    <h1 id="CM_Customers_block_heading_panel_left_sub_h1">
                                        <span class="subheading_text" id="CM_Customers_block_heading_panel_left_sub_h1_text">Customers</span> 
                                        <i class="fa fa-plus-square plush_sign handCursor" id="CM_Customers_block_heading_panel_left_sub_h1_text_plus_icon" ng-click="setFocusToSearchBox()"></i> 
                                        <i class="fa fa-question-circle question_mark" data-toggle="tooltip" title="{{ViewCustomer.helpText['Customers']}}"></i>
                                    </h1>
                                </div>
                                <div class="right_sub pull-right" id="CM_Customers_block_heading_panel_right_sub">
                                    <button id="CM_Customers_block_heading_panel_right_sub_action_btn" class="action_btn btn">Actions</button>
                                </div>
                                <div style="border-bottom : 1px solid black; margin-top: 40px; width: 101%"></div>
                            </div>
                            <div class="gid_container" id="Customers" >
                                <table class="table" id="CM_Customers_UnitsGrid">
                                    <col width="4%"  />
                                    <col width="16%"  />
                                    <col width="26%"  />
                                    <col width="17%" />
                                    <col width="22%"  />
                                    <col width="13%" />
                                    <tr class="tableHeader" ng-click="ViewCustomer.closeEditCustomerRows($event)">
                                        <th></th>
                                        <th>CUSTOMER NUMBER</th>
                                        <th>CUSTOMER NAME</th>
                                        <th>PHONE NUMBER</th>
                                        <th>EMAIL ADDRESS</th>
                                        <th>RELATION</th>
                                    </tr>
                                    <tbody  ng-repeat="indivCustomer in ViewCustomer.CMCustomers" >
                                        <!-- Display rows -->
                                        <tr class="clickable_row" id="row1" rel="rel_customer_row{{$index}}_edit" 
                                        	ng-click="ViewCustomer.editRelatedCustomer($event, $index)" >
                                            <td id="CM_Customers_block_grid_container_tbody_tr_td_1_{{$index}}">
                                                <a href="" class="edite_btn" rel="row1_edit">
                                                    <img src="{!URLFOR($Resource.icon_images, 'images/editicon.png')}" />
                                                </a>
                                            </td>
                                            <td id="CM_Customers_block_grid_container_tbody_tr_td_2_{{$index}}">    <span>{{indivCustomer.CustomerNumber}}</span>   </td>
                                            <td id="CM_Customers_block_grid_container_tbody_tr_td_3_{{$index}}">    <u>{{indivCustomer.CustomerName}}</u>           </td>
                                            <td id="CM_Customers_block_grid_container_tbody_tr_td_4_{{$index}}">
                                                {{indivCustomer.PhoneNumber}}
                                                <i class="fa fa-star orange" ng-show="indivCustomer.IsPreferredPhone && indivCustomer.PhoneNumber != ''"></i>
                                                <i class="fa fa-star-o" ng-show="!indivCustomer.IsPreferredPhone && indivCustomer.PhoneNumber != null && indivCustomer.PhoneNumber != ''"></i>
                                            </td>
                                            <td id="CM_Customers_block_grid_container_tbody_tr_td_5_{{$index}}">
                                                {{indivCustomer.Email}}
                                                <i class="fa fa-star orange" ng-show="indivCustomer.IsPreferredEmail && indivCustomer.Email != ''"></i>
                                                <i class="fa fa-star-o" ng-show="!indivCustomer.IsPreferredEmail && indivCustomer.Email != null && indivCustomer.Email != ''"></i>
                                            </td>
                                            <td id="CM_Customers_block_grid_container_tbody_tr_td_6_{{$index}}" >
                                                <select class="form-control" ng-model="indivCustomer.Relation" 
                                                    ng-click="$event.stopPropagation();"
                                                    ng-change="ViewCustomer.addUpdateCustomerRecord(indivCustomer.Id, indivCustomer.Relation)">
                                                    
                                                    <option value="Family">Family</option>
                                                    <option value="Friend">Friend</option>
                                                    <option value="Employee">Employee</option>
                                                    <option value="Co-Worker">Co-Worker</option>
                                                    <option value="Employer">Employer</option>
                                                </select>
                                            </td>
                                        </tr>
                                        
                                        <!-- Actions row in case editable row -->
                                        <tr ng-show="ViewCustomer.CMCustomers_editRow[$index].isEdit" class="edit_panel sample-show-hide" id="rel_customer_row{{$index}}_edit">
                                            <td colspan="9" id="CM_Customers_block_grid_container_tbody_expandtr_td_1_{{$index}}">
                                                <div id="CM_Customers_block_grid_container_tbody_expandtr_edit_box_{{$index}}" 
                                                    class="edit_box col-lg-9 col-md-9" 
                                                    ng-show="ViewCustomer.CMCustomers_editRow[$index].isEdit">
                                                    
                                                    <div class="its-heading" id="CM_Customers_block_grid_container_tbody_expandtr_edit_box_its-heading_{{$index}}">
                                                        <img src="{!URLFOR($Resource.icon_images, 'images/edit_icon.png')}" styleClass="img_action"/>
                                                        <span>Actions (2 Available)</span>
                                                    </div>
                                                    <div id="CM_Customers_block_grid_container_tbody_expandtr_edit_box_its-heading_edit-body_{{$index}}" class="edit-body">
                                                        <form>
                                                            <!-- Edit link as action -->
                                                            <div class="radio" id="CM_Customers_block_grid_container_tbody_expandtr_edit_box_its-heading_edit-body_{{$index}}_radio_1">
                                                                <label>
	                                                                <input type="radio" name="optionsRadios" id="optionsRadios2" value="1"
	                                                                    ng-model= "ViewCustomer.CMCustomers_editRow[$index].radioValue"/>
	                                                                <span>
								                                        <i class="fa fa-pencil-square-o"></i>
								                                        Edit
								                                    </span>
                                                                </label>
                                                            </div>
                                                            
                                                            <!-- Remove link as action -->
                                                            <div class="radio" id="CM_Customers_block_grid_container_tbody_expandtr_edit_box_its-heading_edit-body_{{$index}}_radio_2">
                                                                <label>
	                                                                <input type="radio" name="optionsRadios" id="optionsRadios2" value="2"
	                                                                    ng-model= "ViewCustomer.CMCustomers_editRow[$index].radioValue"/>
	                                                                <span>
								                                        <i class="fa fa-times"></i>
								                                        Remove Link
								                                    </span>
                                                                </label>
                                                            </div>
                                                            
                                                            <!-- Action button (Go) -->
                                                            <a href="" id="CM_Customers_block_grid_container_tbody_expandtr_edit_box_its-heading_edit-body_{{$index}}_go_btn" class="btn btn-default editform_btn" role="button"
                                                                ng-click="ViewCustomer.CM_Customers_GoAction($index)">  Go  </a>                                
                                                        </form>
                                                    </div>
                                                    <a href="" class="faq_link">
                                                    <i class="fa fa-question-circle qmark"></i>
                                                    </a>
                                                </div>
                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                            <!-- END-: Related Customers list section -->

                            <!-- START: Related Contacts list section -->
                            <div class="heading_panel_sub col-lg-12 col-md-12" id="CM_Contacts_block_heading_panel" ng-click="ViewCustomer.closeEditContactRows($event)" ng-show="ViewCustomer.CustomerInfo.CustomerInfo.Type == 'Business'">
                                <div class="left_sub col-lg-5 col-md-5" id="CM_Contacts_block_heading_panel_left_sub">
                                    <h1 id="CM_Contacts_block_heading_panel_left_sub_h1">
                                        <span class="subheading_text" id="CM_Contacts_block_heading_panel_left_sub_h1_text">Contacts</span> 
                                        <i class="fa fa-plus-square plush_sign handCursor" id="CM_Contacts_block_heading_panel_left_sub_h1_text_plus_icon" ng-click="ViewCustomer.openAddContactPopup()"></i> 
                                        <i class="fa fa-question-circle question_mark" data-toggle="tooltip" title="{{ViewCustomer.helpText['Contacts']}}"></i>
                                    </h1>
                                </div>
                                <div class="right_sub pull-right" id="CM_Contacts_block_heading_panel_right_sub">
                                    <button id="CM_Contacts_block_heading_panel_right_sub_action_btn" class="action_btn btn">Actions</button>
                                </div>
                                <div style="border-bottom : 1px solid black; margin-top: 40px; width: 101%"></div>
                            </div>
                            <div class="gid_container" id="Contacts" ng-show="ViewCustomer.CustomerInfo.CustomerInfo.Type == 'Business'">
                                <table class="table" id="CM_Contacts_UnitsGrid">
                                    <col width="4%"  />
                                    <col width="16%"  />
                                    <col width="26%"  />
                                    <col width="17%" />
                                    <col width="22%"  />
                                    <col width="13%" />
                                    <tr class="tableHeader" ng-click="ViewCustomer.closeEditContactRows($event)">
                                        <th></th>
                                        <th>FIRST NAME</th>
                                        <th>LAST NAME</th>
                                        <th>PHONE NUMBER</th>
                                        <th>EMAIL ADDRESS</th>
                                        <th>RELATION</th>
                                    </tr>
                                    <tbody  ng-repeat="indivContact in ViewCustomer.CMContacts" >
                                        <!-- Display rows -->
                                        <tr class="clickable_row" id="row1" rel="rel_contact_row{{$index}}_edit" 
                                            ng-click="ViewCustomer.editRelatedContact($event, $index)"
                                            ng-blur = "ViewCustomer.editRelatedContact($event, $index)" >
                                            
                                            <td id="CM_Contacts_block_grid_container_tbody_tr_td_1_{{$index}}">
                                                <a href="" class="edite_btn" rel="row1_edit">
                                                    <img src="{!URLFOR($Resource.icon_images, 'images/editicon.png')}" />
                                                </a>
                                            </td>
                                            <td id="CM_Contacts_block_grid_container_tbody_tr_td_2_{{$index}}">     <span>{{indivContact.FirstName}}</span> </td>
                                            <td id="CM_Contacts_block_grid_container_tbody_tr_td_3_{{$index}}">     {{indivContact.LastName}}               </td>
                                            <td id="CM_Contacts_block_grid_container_tbody_tr_td_4_{{$index}}">
                                            	{{indivContact.Phone}}
                                            	<i class="fa fa-star orange" ng-show="indivContact.PreferredPhone && indivContact.Phone != ''"></i>
                                                <i class="fa fa-star-o" ng-show="!indivContact.PreferredPhone && indivContact.Phone != null && indivContact.Phone != ''"></i>
                                            </td>
                                            <td id="CM_Contacts_block_grid_container_tbody_tr_td_5_{{$index}}">
                                            	{{indivContact.Email}}
                                            	<i class="fa fa-star orange" ng-show="indivContact.PreferredEmail && indivContact.Email != ''"></i>
                                                <i class="fa fa-star-o" ng-show="!indivContact.PreferredEmail && indivContact.Email != null && indivContact.Email != ''"></i>
                                            </td>
                                            <td id="CM_Contacts_block_grid_container_tbody_tr_td_6_{{$index}}" >
                                                <select class="form-control" ng-model="indivContact.Relation" 
                                                    ng-change="ViewCustomer.addUpdateContactRecord(indivContact.Id, indivContact.Relation)" 
                                                    ng-click="$event.stopPropagation();">
                                                    
                                                    <option value="Family">Family</option>
                                                    <option value="Friend">Friend</option>
                                                    <option value="Employee">Employee</option>
                                                    <option value="Co-Worker">Co-Worker</option>
                                                    <option value="Employer">Employer</option>
                                                </select>
                                            </td>
                                        </tr>
                                        
                                        <!-- Actions row in case editable row -->
                                        <tr ng-show="ViewCustomer.CMContacts_editRow[$index].isEdit" class="edit_panel sample-show-hide" id="rel_contact_row{{$index}}_edit">
                                            <td colspan="9" id="CM_Contacts_block_grid_container_tbody_expandtr_td_1_{{$index}}">
                                                <div id="CM_Contacts_block_grid_container_tbody_expandtr_edit_box_{{$index}}" 
                                                    class="edit_box col-lg-9 col-md-9" 
                                                    ng-show="ViewCustomer.CMContacts_editRow[$index].isEdit">
                                                    
                                                    <div class="its-heading" id="CM_Contacts_block_grid_container_tbody_expandtr_edit_box_its-heading_{{$index}}">
                                                        <img src="{!URLFOR($Resource.icon_images, 'images/edit_icon.png')}" styleClass="img_action"/>
                                                        <span>Actions (2 Available)</span>
                                                    </div>
                                                    <div id="CM_Contacts_block_grid_container_tbody_expandtr_edit_box_its-heading_edit-body_{{$index}}" class="edit-body">
                                                        <form>
                                                            <!-- Edit link as action -->
                                                            <div class="radio" id="CM_Contacts_block_grid_container_tbody_expandtr_edit_box_its-heading_edit-body_{{$index}}_radio_1">
                                                                <label>
	                                                                <input type="radio" name="optionsRadios" id="optionsRadios2" value="1"
	                                                                    ng-model= "ViewCustomer.CMContacts_editRow[$index].radioValue"/>
	                                                                <span>
								                                        <i class="fa fa-pencil-square-o"></i>
								                                        Edit
								                                    </span>
                                                                </label>
                                                            </div>
                                                            
                                                            <!-- Remove link as action -->
                                                            <div class="radio" id="CM_Contacts_block_grid_container_tbody_expandtr_edit_box_its-heading_edit-body_{{$index}}_radio_2">
                                                                <label>
	                                                                <input type="radio" name="optionsRadios" id="optionsRadios2" value="2"
	                                                                    ng-model= "ViewCustomer.CMContacts_editRow[$index].radioValue"/>
	                                                                <span>
								                                        <i class="fa fa-times"></i>
								                                        Remove Link
								                                    </span>
                                                                </label>
                                                            </div>
                                                            
                                                            <!-- Action button (Go) -->
                                                            <a href="" id="CM_Contacts_block_grid_container_tbody_expandtr_edit_box_its-heading_edit-body_{{$index}}_go_btn" class="btn btn-default editform_btn" role="button"
                                                                ng-click="ViewCustomer.CM_Contacts_GoAction($index)">   Go  </a>                                
                                                        </form>
                                                    </div>
                                                    <a href="" class="faq_link">
                                                    <i class="fa fa-question-circle qmark"></i>
                                                    </a>
                                                </div>
                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                            <!-- END-: Related Contacts list section -->
                            </div>
                            
                        </div>  
                       
                    </div>
                    
                 </div>
              </div>
       </div>
     </body>
     <style>
        .nameDiv h3 {
              width: 95%;
              overflow: hidden;
              text-overflow: ellipsis;
              white-space: nowrap !important;
        }
        .backgroundOrange {
            background-color: orange !important;
            width: 82.4%;
        }
        .divDisplayNone {
            display : none;
        }
        .divDisplayNone .row {
            display : block;
        }
        @-moz-document url-prefix() {
            .order-number{
                margin-top : 0%
            }
        }
     	.errorPageDiv {
     		text-align: center;
		    margin-top: 6%;
     	}
     	.errorPageDiv h1{
     		color: red;
     	}
     	.errorPageDiv h4 a{
     		text-decoration: none;
     	}
     </style>
</html>
</apex:page>