/**
 * Author: Richa Mittal
 * Since: August 12, 2016
 * Name: GlobalSearchCtrl
 * Description: Controller class to handle methods for global Search
**/
global with sharing class GlobalSearchCtrl {
    
    /**
	 * Name: getGlobalSearchResults
	 * Description: Function get records for the search
	 * @Param: 
	 * @Return: String - Search List String 
	**/
    
    
    
    @RemoteAction
    global static String getGlobalSearchResults(String searchQueryJson) {
    	searchQueryJson = BPUtility.getDecodedString(searchQueryJson);
    	GlobalSearchResultsWrapper.GlobalQueryJSON globalQueryJSON = (GlobalSearchResultsWrapper.GlobalQueryJSON)System.JSON.deserialize(searchQueryJson, GlobalSearchResultsWrapper.GlobalQueryJSON.class);
    	String searchText = globalQueryJSON.GlobalSearchText;
    	String searchKeyword = globalQueryJSON.GlobalSearchKeyword;
    	
    	
    	List<Sobject> searchedResultsList = new List<Sobject>();
    	String query;
    	String objectAPIName;
    	for(String objectName : HomeSearchUtil.displayObjectNameToObjectAPINameMap.keySet()){
    		objectAPIName = HomeSearchUtil.displayObjectNameToObjectAPINameMap.get(objectName);
    		query = 'SELECT '; 
	        for(String fieldsName : HomeSearchUtil.searchableObjectToFieldsMap.get(objectAPIName)){
	        	fieldsName = BPUtility.escapeSingleQuotes(fieldsName);
	            query += fieldsName + ', ';
	        }
	        query = query.substring(0, query.length()-2);
	        query += ' FROM ' + Constants.NAMESPACE + objectAPIName;
	        query += ' WHERE '+ HomeSearchReportInterface.getContainsCondition(objectName, searchText);
	        //System.assert(false, query);
	        /*
	        if(objectAPIName == 'Account') {
	            query += 'WHERE '; 
	        }
	        query += ' ORDER BY Default__c DESC, Name__c ASC';*/
	        searchedResultsList.addAll((List<Sobject>)Database.query(query));
    	}
    	List<GlobalSearchResultsWrapper> globalSearchResultsList = new List<GlobalSearchResultsWrapper>();
    	
    	for(Sobject sObj : searchedResultsList) {
    		globalSearchResultsList.add(new GlobalSearchResultsWrapper(sObj));
    	}
    	return BPUtility.getEncodedString(System.JSON.serialize(globalSearchResultsList));
    }
}